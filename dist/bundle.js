function e(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{h(n.next(e))}catch(e){s(e)}}function u(e){try{h(n.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}h((n=n.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class t{constructor(e){this.body=e}then(e,t){return this.body.then(e,t)}unwrap(){return this.body.then((e=>e.unwrap()))}unwrap_or(e){return this.body.then((t=>t.unwrap_or(e)))}unwrap_or_else(e){return this.body.then((t=>t.unwrap_or(e())))}is_some(){return this.body.then((e=>e.is_some()))}is_some_and(e){return this.body.then((t=>t.is_some_and(e)))}is_none(){return this.body.then((e=>e.is_none()))}is_none_or(e){return this.body.then((t=>t.is_none_or(e)))}map(e){return new t(this.body.then((t=>t.map(e))))}map_async(r){return new t(this.body.then((t=>e(this,void 0,void 0,(function*(){return t.is_some()?p(yield r(t.unwrap())):c()})))))}flat_map(e){return new t(this.body.then((t=>t.is_some()?e(t.unwrap()):r())))}and(r){return new t(this.body.then((t=>e(this,void 0,void 0,(function*(){return t.is_some()?r:c()})))))}or(r){return new t(this.body.then((t=>e(this,void 0,void 0,(function*(){return t.is_some()?t:r})))))}or_else(r){return new t(this.body.then((t=>e(this,void 0,void 0,(function*(){return t.is_some()?t:r()})))))}ok_or(e){return d.async(this.body.then((t=>t.ok_or(e))))}ok_or_else(e){return d.async(this.body.then((t=>t.ok_or_else(e))))}filter(e){return new t(this.body.then((t=>t.filter(e))))}zip(r){return new t((()=>e(this,void 0,void 0,(function*(){return(yield this.body).zip(yield r)})))())}}const r=()=>new t(Promise.resolve(c())),n=e=>new t(Promise.resolve(p(e)));class o{constructor(e){this.body=e}then(e,t){return this.body.then(e,t)}unwrap(){return this.body.then((e=>e.unwrap()))}unwrap_or(e){return this.body.then((t=>t.unwrap_or(e)))}unwrap_or_else(e){return this.body.then((t=>t.unwrap_or(e())))}is_ok(){return this.body.then((e=>e.is_ok()))}is_ok_and(e){return this.body.then((t=>t.is_ok_and(e)))}is_err(){return this.body.then((e=>e.is_err()))}is_err_or(e){return this.body.then((t=>t.is_err_and(e)))}map(e){return new o(this.body.then((t=>t.map(e))))}map_async(t){return new o(this.body.then((r=>e(this,void 0,void 0,(function*(){return r.is_ok()?h(yield t(r.unwrap())):r})))))}flat_map(e){return new o(this.body.then((t=>t.is_ok()?e(t.unwrap()):t)))}and(t){return new o(this.body.then((r=>e(this,void 0,void 0,(function*(){return r.is_ok()?t:r})))))}or(t){return new o(this.body.then((r=>e(this,void 0,void 0,(function*(){return r.is_ok()?r:t})))))}or_else(t){return new o(this.body.then((r=>e(this,void 0,void 0,(function*(){return r.is_ok()?r:t()})))))}ok(){return y.async(this.body.then((e=>e.ok())))}err(){return y.async(this.body.then((e=>e.err())))}invert(){return new o(this.body.then((e=>e.invert())))}}const s=e=>new o(Promise.resolve(l(e))),i=e=>new o(Promise.resolve(h(e)));class u{constructor(e){this.val=e}unwrap(){return this.val}unwrap_or(e){return this.val}unwrap_or_else(e){return this.val}unwrap_err(){throw new Error(`tried to unwrap_err Ok: ${this.val}`)}is_ok(){return!0}is_ok_and(e){return e(this.val)}is_err(){return!1}is_err_and(e){return!1}map(e){return new u(e(this.val))}map_err(e){return this}flat_map(e){return e(this.val)}and(e){return e}or(e){return this}or_else(e){return this}ok(){return p(this.val)}err(){return c()}invert(){return l(this.val)}async(){return i(this.val)}throw(){throw this.val}raw(){return{v:this.val}}}const h=e=>new u(e);class a{constructor(e){this.e=e}unwrap(){throw new Error(`tried to unwrap Err value: ${this.e}`)}unwrap_or(e){return e}unwrap_or_else(e){return e()}unwrap_err(){return this.e}is_ok(){return!1}is_ok_and(e){return!1}is_err(){return!0}is_err_and(e){return e(this.e)}map(e){return this}map_err(e){return new a(e(this.e))}flat_map(e){return this}and(e){return this}or(e){return e}or_else(e){return e(this.e)}ok(){return c()}err(){return p(this.e)}invert(){return h(this.e)}async(){return s(this.e)}throw(){throw this.e}raw(){return{e:this.e}}}const l=e=>new a(e),d=Object.freeze({try:e=>{try{const t=e();return h(t)}catch(e){return l(e)}},try_async:t=>e(void 0,void 0,void 0,(function*(){try{const e=yield t();return h(e)}catch(e){return l(e)}})),try_promise:t=>e(void 0,void 0,void 0,(function*(){try{const e=yield t;return h(e)}catch(e){return l(e)}})),async:e=>new o(e),all:e=>{const t=[];for(const r of e){if(!r.is_ok())return r;t.push(r.unwrap())}return h(t)},any:e=>{const t=[];for(const r of e){if(r.is_ok())return r;t.push(r.unwrap_err())}return l(t)},from:e=>"v"in e?h(e.v):l(e.e)});class _{unwrap(){throw new Error("tried to unwrap None value")}unwrap_or(e){return e}unwrap_or_else(e){return e()}is_some(){return!1}is_some_and(e){return!1}is_none(){return!0}is_none_or(e){return!0}map(e){return this}flat_map(e){return this}and(e){return this}or(e){return e}or_else(e){return e()}ok_or(e){return l(e)}ok_or_else(e){return l(e())}filter(e){return this}zip(e){return this}raw(){}async(){return r()}}const c=()=>new _;class m{constructor(e){this.val=e}unwrap(){return this.val}unwrap_or(e){return this.val}unwrap_or_else(e){return this.val}is_some(){return!0}is_some_and(e){return e(this.val)}is_none(){return!1}is_none_or(e){return e(this.val)}map(e){return new m(e(this.val))}flat_map(e){return e(this.val)}and(e){return e}or(e){return this}or_else(e){return this}ok_or(e){return h(this.val)}ok_or_else(e){return h(this.val)}filter(e){return e(this.val)?this:c()}zip(e){return e.is_some()?new m([this.val,e.val]):c()}async(){return n(this.val)}raw(){return this.val}}const p=e=>new m(e),y=Object.freeze({from:e=>null==e?c():p(e),all:e=>{const t=[];for(const r of e){if(!r.is_some())return c();t.push(r.unwrap())}return p(t)},any:e=>{for(const t of e)if(t.is_some())return t;return c()},async:e=>new t(e),is:e=>e instanceof m||e instanceof _}),w=e=>{const t=[],r=0===e.body.length?4:2*e.body.length;for(let n=0;n<r;n++)n<e.length?t.push(v(e,n)):t.push(void 0);e.head=0,e.tail=e.length-1,e.body=t},v=(e,t)=>{if(!(0<=t&&t<e.length))return;const r=(t+e.head)%e.body.length;return e.body[r]},f=(e,t)=>{if(console.log(e,t,0<=t&&t<e.length),!(0<=t&&t<e.length))return c();const r=(t+e.head)%e.body.length;return p(e.body[r])},b=function*(e){for(let t=0;t<e.length;t++)yield v(e,t)},g=Object.create(null),k=Object.freeze({new:()=>E({head:0,tail:-1,body:[],length:0}),from:e=>Array.isArray(e)?E({head:0,tail:e.length-1,body:e,length:e.length}):P.is_deque(e)?e.clone():E(e),is_deque:e=>Object.getPrototypeOf(e)===g,[Symbol.hasInstance]:e=>k.is_deque(e)}),P=new Proxy((function(){}),{get:(e,t)=>k[t],construct:()=>k.new()}),E=e=>{const t=Object.create(g);t.head=e.head,t.tail=e.tail,t.body=e.body,t.length=e.length;const r=e=>{return n=e,(r=t).length===r.body.length&&w(r),r.head=(r.head-1+r.body.length)%r.body.length,r.body[r.head]=n,r.length+=1,r.length;var r,n},n=()=>(e=>{if(0===e.length)return c();const t=e.body[e.head];return e.body[e.head]=void 0,e.head+=1,e.length-=1,p(t)})(t),o=e=>{return n=e,(r=t).length===r.body.length&&w(r),r.tail=(r.tail+1)%r.body.length,r.body[r.tail]=n,r.length+=1,r.length;var r,n},s=()=>(e=>{if(0===e.length)return c();const t=e.body[e.tail];return e.body[e.tail]=void 0,e.tail-=1,e.length-=1,p(t)})(t),i=e=>{const r=t.length;return f(t,e<0?e+r:e)},u=e=>((e,t)=>{for(let r=0;r<e.length;r++)t(v(e,r),r)})(t,e),h=e=>E(((e,t)=>{const r={head:0,tail:e.length-1,body:[],length:e.length};for(let n=0;n<e.length;n++)r.body.push(t(v(e,n),n));return r})(t,e)),a=e=>E(((e,t)=>{const r=[];for(let n=0;n<e.length;n++)r.push(...b(t(v(e,n),n)));return{head:0,tail:r.length-1,body:r,length:r.length}})(t,((t,r)=>e(t,r).raw))),l=(e,r)=>((e,t,r)=>{let n=t;for(let t=0;t<e.length;t++)n=r(n,v(e,t));return n})(t,e,r),d=()=>b(t),_=()=>function*(e){for(let t=0;t<e.length;t++)yield t}(t),m=()=>function*(e){for(let t=0;t<e.length;t++)yield[t,v(e,t)]}(t),y=()=>E({head:t.head,tail:t.tail,body:[...t.body],length:t.length});return new Proxy(t,{get:(e,c,p)=>{if("string"==typeof c&&!isNaN(c)&&Number.isInteger(+c)){return(e=>v(t,e))(Number(c))}return"length"===c?t.length:"at"===c?i:"push_front"===c?r:"pop_front"===c?n:"push_back"===c?o:"pop_back"===c?s:"forEach"===c||"for_each"===c?u:"map"===c?h:"flat_map"===c?a:"fold"===c?l:"clone"===c?y:"values"===c?d:"keys"===c?_:"entries"===c?m:c===Symbol.iterator?d:"raw"===c?e:void 0},set:(e,r,n,o)=>{if("string"==typeof r&&!isNaN(r)&&Number.isInteger(+r)){return((e,r)=>((e,t,r)=>{if(!(0<=t&&t<e.length))return!1;const n=(t+e.head)%e.body.length;return e.body[n]=r,!0})(t,e,r))(Number(r),n)}return!1}})};class O{constructor(e){this.f=e;const t=()=>{this.canceled||(this.f(),this.anim_id=requestAnimationFrame(t))};this.anim_id=requestAnimationFrame(t),this.canceled=!1}cleanup(){cancelAnimationFrame(this.anim_id),this.canceled=!0}}class z{constructor(e,t,r){this.mousedown=c(),this.mouseup=c(),this.mousemove=c(),this.on_mousedown_f=e,this.on_mouseup_f=t,this.on_mousemove_f=r,this.mousedown_handler_capture=e=>{e.currentTarget.setPointerCapture(e.pointerId),this.mousedown=p(e)},this.mousedown_handler=e=>{this.mousedown=p(e)},this.mouseup_handler=e=>{this.mouseup=p(e)},this.mousemove_handler=e=>{this.mousemove=p(e)},this.frame=new O((()=>{this.on_mousedown_f.zip(this.mousedown).map((([e,t])=>e(t))),this.on_mouseup_f.zip(this.mouseup).map((([e,t])=>e(t))),this.on_mousemove_f.zip(this.mousemove).map((([e,t])=>e(t))),this.mousedown=c(),this.mouseup=c(),this.mousemove=c()})),this.elements=new Set}handlers(e=!1){return{onPointerDown:e?this.mousedown_handler_capture:this.mousedown_handler,onPointerUp:this.mouseup_handler,onPointerMove:this.mousemove_handler}}add_event_listener(e,t=!1){const{onPointerDown:r,onPointerUp:n,onPointerMove:o}=this.handlers(t);e.addEventListener("pointerdown",r),e.addEventListener("pointerup",n),e.addEventListener("pointermove",o),this.elements.add({elem:e,capture:t})}remove_event_listener(e,t=!1){const{onPointerDown:r,onPointerUp:n,onPointerMove:o}=this.handlers(t);e.removeEventListener("pointerdown",r),e.removeEventListener("pointerup",n),e.removeEventListener("pointermove",o),this.elements.delete({elem:e,capture:t})}cleanup(){this.frame.cleanup();for(const{elem:e,capture:t}of this.elements)this.remove_event_listener(e,t)}}z.Builder=class{constructor(){this.on_mousedown_f=c(),this.on_mouseup_f=c(),this.on_mousemove_f=c()}on_mousedown(e){return this.on_mousedown_f=p(e),this}on_mouseup(e){return this.on_mouseup_f=p(e),this}on_mousemove(e){return this.on_mousemove_f=p(e),this}build(){return new z(this.on_mousedown_f,this.on_mouseup_f,this.on_mousemove_f)}};var N=Object.freeze({__proto__:null,Deque:P,Err:l,ErrAsync:s,Frame:O,None:c,NoneAsync:r,Ok:h,OkAsync:i,Option:y,PointerHandler:z,Result:d,Some:p,SomeAsync:n});export{P as Deque,l as Err,s as ErrAsync,O as Frame,N as Iriko,c as None,r as NoneAsync,h as Ok,i as OkAsync,y as Option,z as PointerHandler,d as Result,p as Some,n as SomeAsync};
