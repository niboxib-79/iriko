function t(t,e,r,n){return new(r||(r=Promise))((function(s,o){function i(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,a)}u((n=n.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class e{constructor(t){this.body=t}then(t,e){return this.body.then(t,e)}unwrap(){return this.body.then((t=>t.unwrap()))}unwrap_or(t){return this.body.then((e=>e.unwrap_or(t)))}unwrap_or_else(t){return this.body.then((e=>e.unwrap_or(t())))}is_some(){return this.body.then((t=>t.is_some()))}is_some_and(t){return this.body.then((e=>e.is_some_and(t)))}is_none(){return this.body.then((t=>t.is_none()))}is_none_or(t){return this.body.then((e=>e.is_none_or(t)))}map(t){return new e(this.body.then((e=>e.map(t))))}map_async(r){return new e(this.body.then((e=>t(this,void 0,void 0,(function*(){return e.is_some()?p(yield r(e.unwrap())):d()})))))}flat_map(t){return new e(this.body.then((e=>e.is_some()?t(e.unwrap()):r())))}and(r){return new e(this.body.then((e=>t(this,void 0,void 0,(function*(){return e.is_some()?r:d()})))))}or(r){return new e(this.body.then((e=>t(this,void 0,void 0,(function*(){return e.is_some()?e:r})))))}or_else(r){return new e(this.body.then((e=>t(this,void 0,void 0,(function*(){return e.is_some()?e:r()})))))}ok_or(t){return c.async(this.body.then((e=>e.ok_or(t))))}ok_or_else(t){return c.async(this.body.then((e=>e.ok_or_else(t))))}filter(t){return new e(this.body.then((e=>e.filter(t))))}zip(r){return new e((()=>t(this,void 0,void 0,(function*(){return(yield this.body).zip(yield r)})))())}}const r=()=>new e(Promise.resolve(d())),n=t=>new e(Promise.resolve(p(t)));class s{constructor(t){this.body=t}then(t,e){return this.body.then(t,e)}unwrap(){return this.body.then((t=>t.unwrap()))}unwrap_or(t){return this.body.then((e=>e.unwrap_or(t)))}unwrap_or_else(t){return this.body.then((e=>e.unwrap_or(t())))}is_ok(){return this.body.then((t=>t.is_ok()))}is_ok_and(t){return this.body.then((e=>e.is_ok_and(t)))}is_err(){return this.body.then((t=>t.is_err()))}is_err_or(t){return this.body.then((e=>e.is_err_and(t)))}map(t){return new s(this.body.then((e=>e.map(t))))}map_async(e){return new s(this.body.then((r=>t(this,void 0,void 0,(function*(){return r.is_ok()?u(yield e(r.unwrap())):r})))))}flat_map(t){return new s(this.body.then((e=>e.is_ok()?t(e.unwrap()):e)))}and(e){return new s(this.body.then((r=>t(this,void 0,void 0,(function*(){return r.is_ok()?e:r})))))}or(e){return new s(this.body.then((r=>t(this,void 0,void 0,(function*(){return r.is_ok()?r:e})))))}or_else(e){return new s(this.body.then((r=>t(this,void 0,void 0,(function*(){return r.is_ok()?r:e()})))))}ok(){return m.async(this.body.then((t=>t.ok())))}err(){return m.async(this.body.then((t=>t.err())))}invert(){return new s(this.body.then((t=>t.invert())))}}const o=t=>new s(Promise.resolve(_(t))),i=t=>new s(Promise.resolve(u(t)));class a{constructor(t){this.val=t}unwrap(){return this.val}unwrap_or(t){return this.val}unwrap_or_else(t){return this.val}unwrap_err(){throw new Error(`tried to unwrap_err Ok: ${this.val}`)}is_ok(){return!0}is_ok_and(t){return t(this.val)}is_err(){return!1}is_err_and(t){return!1}map(t){return new a(t(this.val))}map_err(t){return this}flat_map(t){return t(this.val)}and(t){return t}or(t){return this}or_else(t){return this}ok(){return p(this.val)}err(){return d()}invert(){return _(this.val)}async(){return i(this.val)}throw(){throw this.val}}const u=t=>new a(t);class h{constructor(t){this.e=t}unwrap(){throw new Error(`tried to unwrap Err value: ${this.e}`)}unwrap_or(t){return t}unwrap_or_else(t){return t()}unwrap_err(){return this.e}is_ok(){return!1}is_ok_and(t){return!1}is_err(){return!0}is_err_and(t){return t(this.e)}map(t){return this}map_err(t){return new h(t(this.e))}flat_map(t){return this}and(t){return this}or(t){return t}or_else(t){return t(this.e)}ok(){return d()}err(){return p(this.e)}invert(){return u(this.e)}async(){return o(this.e)}throw(){throw this.e}}const _=t=>new h(t),c=Object.freeze({try:t=>{try{const e=t();return u(e)}catch(t){return _(t)}},try_async:e=>t(void 0,void 0,void 0,(function*(){try{const t=yield e();return u(t)}catch(t){return _(t)}})),try_promise:e=>t(void 0,void 0,void 0,(function*(){try{const t=yield e;return u(t)}catch(t){return _(t)}})),async:t=>new s(t),all:t=>{const e=[];for(const r of t){if(!r.is_ok())return r;e.push(r.unwrap())}return u(e)},any:t=>{const e=[];for(const r of t){if(r.is_ok())return r;e.push(r.unwrap_err())}return _(e)}});class l{unwrap(){throw new Error("tried to unwrap None value")}unwrap_or(t){return t}unwrap_or_else(t){return t()}is_some(){return!1}is_some_and(t){return!1}is_none(){return!0}is_none_or(t){return!0}map(t){return this.cast()}flat_map(t){return this.cast()}and(t){return this.cast()}or(t){return t}or_else(t){return t()}ok_or(t){return _(t)}ok_or_else(t){return _(t())}filter(t){return this}zip(t){return this}raw(){}async(){return r()}cast(){return this.cast()}}const d=()=>new l;class f{constructor(t){this.val=t}unwrap(){return this.val}unwrap_or(t){return this.val}unwrap_or_else(t){return this.val}is_some(){return!0}is_some_and(t){return t(this.val)}is_none(){return!1}is_none_or(t){return t(this.val)}map(t){return new f(t(this.val))}flat_map(t){return t(this.val)}and(t){return t}or(t){return this}or_else(t){return this}ok_or(t){return u(this.val)}ok_or_else(t){return u(this.val)}filter(t){return t(this.val)?this:d()}zip(t){return t.is_some()?new f([this.val,t.val]):d()}async(){return n(this.val)}raw(){return this.val}}const p=t=>new f(t),m=Object.freeze({from:t=>null==t?d():p(t),all:t=>{const e=[];for(const r of t){if(!r.is_some())return d();e.push(r.unwrap())}return p(e)},any:t=>{for(const e of t)if(e.is_some())return e;return d()},async:t=>new e(t),is:t=>t instanceof f||t instanceof l}),k=(t,e)=>e<t.stack_front.length?t.stack_front[t.stack_front.length-e-1]:t.stack_back[e-t.stack_front.length],w=(t,e)=>{for(let r=0;r<t.stack_front.length;r++)e(t.stack_front[t.stack_front.length-r-1],r);for(let r=0;r<t.stack_back.length;r++)e(t.stack_front[r],r+t.stack_front.length)},v=function*(t){const e=t.stack_front.length+t.stack_back.length;let r=0;for(;r<e;)yield k(t,r),r+=1},y=Object.create(null),b=Object.freeze({new:()=>P({stack_back:[],stack_front:[]}),from:t=>Array.isArray(t)?P({stack_back:t,stack_front:[]}):g.is_deque(t)?t.clone():P(t),is_deque:t=>Object.getPrototypeOf(t)===y,[Symbol.hasInstance]:t=>b.is_deque(t)}),g=new Proxy((function(){}),{get:(t,e)=>b[e],construct:()=>b.new()}),P=t=>{const e=Object.create(y);e.stack_front=t.stack_front,e.stack_back=t.stack_back;const r=t=>((t,e)=>(t.stack_front.push(e),t.stack_back.length+t.stack_front.length))(e,t),n=()=>(t=>{if(t.stack_front.length+t.stack_front.length===0)return d();if(0===t.stack_front.length)for(;t.stack_back.length>0;)t.stack_front.push(t.stack_back.pop());return p(t.stack_front.pop())})(e),s=t=>((t,e)=>(t.stack_back.push(e),t.stack_back.length+t.stack_front.length))(e,t),o=()=>(t=>{if(t.stack_front.length+t.stack_front.length===0)return d();if(0===t.stack_back.length)for(;t.stack_front.length>0;)t.stack_back.push(t.stack_front.pop());return p(t.stack_back.pop())})(e),i=t=>{const r=e.stack_back.length+e.stack_front.length;((t,e)=>{0<=e&&e<t.stack_front.length+t.stack_back.length?p(k(t,e)):d()})(e,(t%r+r)%r)},a=t=>w(e,t),u=t=>P(((t,e)=>({stack_front:t.stack_front.map(e),stack_back:t.stack_back.map(e)}))(e,t)),h=t=>P(((t,e)=>{const r=[];return w(t,((t,n)=>{const s=e(t,n);r.push(...v(s))})),{stack_front:[],stack_back:r}})(e,t)),_=(t,r)=>((t,e,r)=>{let n=e;return w(t,(t=>{n=r(n,t)})),n})(e,t,r),c=()=>v(e),l=()=>function*(t){const e=t.stack_front.length+t.stack_back.length;let r=0;for(;r<e;)yield r,r+=1}(e),f=()=>function*(t){const e=t.stack_front.length+t.stack_back.length;let r=0;for(;r<e;)yield[r,k(t,r)],r+=1}(e),m=()=>P({stack_front:[...e.stack_front],stack_back:[...e.stack_back]});return new Proxy(e,{get:(t,d,p)=>{if("string"==typeof d&&!isNaN(d)&&Number.isInteger(+d)){return(t=>k(e,t))(Number(d))}return"length"===d?e.stack_back.length+e.stack_front.length:"at"===d?i:"push_front"===d?r:"pop_front"===d?n:"push_back"===d?s:"pop_back"===d?o:"forEach"===d?a:"map"===d?u:"flat_map"===d?h:"fold"===d?_:"clone"===d?m:"values"===d?c:"keys"===d?l:"entries"===d?f:d===Symbol.iterator?c:void 0},set:(t,r,n,s)=>{if("string"==typeof r&&!isNaN(r)&&Number.isInteger(+r)){return((t,r)=>((t,e,r)=>e<t.stack_front.length?(t.stack_front[t.stack_front.length-e-1]=r,!0):t.stack_front.length+t.stack_back.length<=e&&(t.stack_back[e-t.stack_front.length]=r,!0))(e,t,r))(Number(r),n)}return!1}})};class E{constructor(t){this.f=t;const e=()=>{this.canceled||(this.f(),this.anim_id=requestAnimationFrame(e))};this.anim_id=requestAnimationFrame(e),this.canceled=!1}cleanup(){cancelAnimationFrame(this.anim_id),this.canceled=!0}}class O{constructor(t,e,r){this.mousedown=d(),this.mouseup=d(),this.mousemove=d(),this.on_mousedown_f=t,this.on_mouseup_f=e,this.on_mousemove_f=r,this.mousedown_handler_capture=t=>{t.currentTarget.setPointerCapture(t.pointerId),this.mousedown=p(t)},this.mousedown_handler=t=>{this.mousedown=p(t)},this.mouseup_handler=t=>{this.mouseup=p(t)},this.mousemove_handler=t=>{this.mousemove=p(t)},this.frame=new E((()=>{this.on_mousedown_f.zip(this.mousedown).map((([t,e])=>t(e))),this.on_mouseup_f.zip(this.mouseup).map((([t,e])=>t(e))),this.on_mousemove_f.zip(this.mousemove).map((([t,e])=>t(e))),this.mousedown=d(),this.mouseup=d(),this.mousemove=d()})),this.elements=new Set}handlers(t=!1){return{onPointerDown:t?this.mousedown_handler_capture:this.mousedown_handler,onPointerUp:this.mouseup_handler,onPointerMove:this.mousemove_handler}}add_event_listener(t,e=!1){const{onPointerDown:r,onPointerUp:n,onPointerMove:s}=this.handlers(e);t.addEventListener("pointerdown",r),t.addEventListener("pointerup",n),t.addEventListener("pointermove",s),this.elements.add({elem:t,capture:e})}remove_event_listener(t,e=!1){const{onPointerDown:r,onPointerUp:n,onPointerMove:s}=this.handlers(e);t.removeEventListener("pointerdown",r),t.removeEventListener("pointerup",n),t.removeEventListener("pointermove",s),this.elements.delete({elem:t,capture:e})}cleanup(){this.frame.cleanup();for(const{elem:t,capture:e}of this.elements)this.remove_event_listener(t,e)}}O.Builder=class{constructor(){this.on_mousedown_f=d(),this.on_mouseup_f=d(),this.on_mousemove_f=d()}on_mousedown(t){return this.on_mousedown_f=p(t),this}on_mouseup(t){return this.on_mouseup_f=p(t),this}on_mousemove(t){return this.on_mousemove_f=p(t),this}build(){return new O(this.on_mousedown_f,this.on_mouseup_f,this.on_mousemove_f)}};var z=Object.freeze({__proto__:null,Deque:g,Err:_,ErrAsync:o,Frame:E,None:d,NoneAsync:r,Ok:u,OkAsync:i,Option:m,PointerHandler:O,Result:c,Some:p,SomeAsync:n});export{g as Deque,_ as Err,o as ErrAsync,E as Frame,z as Iriko,d as None,r as NoneAsync,u as Ok,i as OkAsync,m as Option,O as PointerHandler,c as Result,p as Some,n as SomeAsync};
